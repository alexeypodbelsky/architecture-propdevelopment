# 1 Требования

1. Каждый запрос из Mobile Apps к Smart Home Gateway должен содержать аутентификационные данные
2. Smart Home Gateway должен определять, имеет ли аутентифицированный пользователь право на выполнение запрошенного действия (например, открытие домофона для квартиры X) 
3. Smart Home Platform должна быть уверена, что запросы поступают от доверенного Smart Home Gateway и наоборот. 
4. Персональные данные, хранящиеся в Access Control DB (например, номера автомобилей, биометрические данные), должны быть зашифрованы
5. Smart Home Gateway и Smart Home Platform должны соответствовать требованиям ФЗ-152 в отношении обработки персональных данных. 
6. Smart Home Platform должна разрешать доступ к API только для авторизованных клиентов (только для Smart Home Gateway)
7.  Ограничить количество запросов, которые Smart Home Gateway может отправлять в Smart Home Platform за определенный период времени, для предотвращения DDoS-атак (Rate Limiting)
8. Должны регистрировать все важные события, включая аутентификацию, авторизацию, доступ к данным и ошибки

# 2 Протоколы аутентификации и авторизации

- Mobile Apps <-> Smart Home Gateway (Аутентификация): JWT.

- Smart Home Gateway (Авторизация): RBAC (Role-Based Access Control) с хранением данных в Access Control DB.

- Smart Home Gateway <-> Smart Home Platform (Аутентификация): API Key 

# 3 Взаимодействие между системами предприятия и внешней платформой

Общая схема:

1. Пользователь аутентифицируется в Mobile Apps через auth-service-1 и получает токен JWT.

2. Mobile Apps отправляет запрос в Smart Home Gateway (с токеном JWT).

3. Smart Home Gateway:

   - Аутентифицирует запрос (проверяет токен).
   - Авторизует запрос (проверяет права пользователя в Access Control DB).
   - Отправляет запрос в Smart Home Platform (HTTPS/REST c API KEY).

4. Smart Home Platform выполняет действие и возвращает результат в Smart Home Gateway.

5. Smart Home Gateway возвращает результат в Mobile Apps.

6. Smart Home Platform отправляет уведомления в Smart Home Gateway с данными о распознанном лице или номере автомобиля (HTTPS/REST c API KEY)

7. Если номер или лицо найдены и пользователь имеет право доступа, Smart Home Gateway отправляет команду на открытие шлагбаума или домофона

8. Логирование всех действий